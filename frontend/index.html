<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; }
        .glass { background: rgba(20, 20, 20, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .animate-scan { animation: scan 2s linear infinite; }
        @keyframes scan { 0% { width: 0%; } 100% { width: 100%; } }
    </style>
</head>
<body class="p-6">
    <div id="startup" class="fixed inset-0 bg-black z-50 flex flex-col items-center justify-center p-10">
        <h1 class="text-5xl font-black italic mb-4">$TAGE</h1>
        <p id="status" class="text-blue-500 font-bold">VERIFYING ACCOUNT AGE...</p>
        <div class="w-full bg-zinc-900 h-1 mt-4 overflow-hidden"><div class="bg-blue-600 h-full animate-scan"></div></div>
    </div>

    <div id="app" class="hidden">
        <div class="glass p-6 rounded-3xl text-center mb-8">
            <p class="text-xs text-gray-500 font-bold uppercase tracking-widest">Total Balance</p>
            <h2 id="bal" class="text-4xl font-black italic mt-2">0</h2>
        </div>

        <div class="glass p-6 rounded-[2rem] border border-blue-500/30">
            <div class="flex justify-between items-center mb-4">
                <div><p class="font-bold">Daily Ad Bonus</p><p class="text-[10px] text-blue-400">+1,000 $TAGE</p></div>
                <div class="text-right"><span id="ads-left" class="text-blue-500 font-black">10</span><p class="text-[8px] text-gray-500 uppercase">Left</p></div>
            </div>
            <button onclick="watchAd()" id="ad-btn" class="w-full bg-blue-600 py-4 rounded-2xl font-black">WATCH AD</button>
        </div>

        <button onclick="invite()" class="w-full mt-6 bg-zinc-900 py-4 rounded-2xl font-bold border border-white/5">INVITE FRIENDS (20%)</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        const API = "https://tagebot-production.up.railway.app";
        let userData = {};

        async function init() {
            const urlParams = new URLSearchParams(window.location.search);
            const res = await fetch(`${API}/auth`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    userId: tg.initDataUnsafe.user.id,
                    username: tg.initDataUnsafe.user.username,
                    refBy: urlParams.get('tgWebAppStartParam')
                })
            });
            userData = await res.json();
            
            setTimeout(() => {
                document.getElementById('startup').classList.add('hidden');
                document.getElementById('app').classList.remove('hidden');
                updateUI();
            }, 3000);
        }

        function updateUI() {
            document.getElementById('bal').innerText = userData.points.toLocaleString();
            document.getElementById('ads-left').innerText = 10 - userData.daily_ads_watched;
        }

        async function watchAd() {
            const res = await fetch(`${API}/watch-ad`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ userId: userData.telegram_id })
            });
            userData = await res.json();
            updateUI();
        }

        function invite() {
            const link = `https://t.me/your_bot?start=${userData.telegram_id}`;
            tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=Join $TAGE!`);
        }

        init();
    </script>
</body>
</html>
